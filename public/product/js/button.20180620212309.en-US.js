//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(){var t,e=this,i=e.Backbone,n=Array.prototype.slice,s=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var o=e._;o||"undefined"==typeof require||(o=require("underscore"));var r=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){r=t},t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=/\s+/,l=t.Events={on:function(t,e,i){var n,s,o,r,l;if(!e)return this;for(t=t.split(a),n=this._callbacks||(this._callbacks={});s=t.shift();)l=n[s],o=l?l.tail:{},o.next=r={},o.context=i,o.callback=e,n[s]={tail:r,next:l?l.next:o};return this},off:function(t,e,i){var n,s,r,l,c,h;if(s=this._callbacks){if(!(t||e||i))return delete this._callbacks,this;for(t=t?t.split(a):o.keys(s);n=t.shift();)if(r=s[n],delete s[n],r&&(e||i))for(l=r.tail;(r=r.next)!==l;)c=r.callback,h=r.context,(e&&c!==e||i&&h!==i)&&this.on(n,c,h);return this}},trigger:function(t){var e,i,s,o,r,l,c;if(!(s=this._callbacks))return this;for(l=s.all,t=t.split(a),c=n.call(arguments,1);e=t.shift();){if(i=s[e])for(o=i.tail;(i=i.next)!==o;)i.callback.apply(i.context||this,c);if(i=l)for(o=i.tail,r=[e].concat(c);(i=i.next)!==o;)i.callback.apply(i.context||this,r)}return this}};l.bind=l.on,l.unbind=l.off;var c=t.Model=function(t,e){var i;t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=L(this,"defaults"))&&(t=o.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(c.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var i=this.get(t);return this._escapedAttributes[t]=o.escape(null==i?"":""+i)},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,s,r;if(o.isObject(t)||null==t?(n=t,i=e):(n={},n[t]=e),i||(i={}),!n)return this;if(n instanceof c&&(n=n.attributes),i.unset)for(s in n)n[s]=void 0;if(!this._validate(n,i))return!1;this.idAttribute in n&&(this.id=n[this.idAttribute]);var a=i.changes={},l=this.attributes,h=this._escapedAttributes,d=this._previousAttributes||{};for(s in n)r=n[s],(!o.isEqual(l[s],r)||i.unset&&o.has(l,s))&&(delete h[s],(i.silent?this._silent:a)[s]=!0),i.unset?delete l[s]:l[s]=r,o.isEqual(d[s],r)&&o.has(l,s)==o.has(d,s)?(delete this.changed[s],delete this._pending[s]):(this.changed[s]=r,i.silent||(this._pending[s]=!0));return i.silent||this.change(i),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(e){e=e?o.clone(e):{};var i=this,n=e.success;return e.success=function(t,s,o){return i.set(i.parse(t,o),e)?void(n&&n(i,t)):!1},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i,n){var s,r;if(o.isObject(e)||null==e?(s=e,n=i):(s={},s[e]=i),n=n?o.clone(n):{},n.wait){if(!this._validate(s,n))return!1;r=o.clone(this.attributes)}var a=o.extend({},n,{silent:!0});if(s&&!this.set(s,n.wait?a:n))return!1;var l=this,c=n.success;n.success=function(t,e,i){var r=l.parse(t,i);return n.wait&&(delete n.wait,r=o.extend(s||{},r)),l.set(r,n)?void(c?c(l,t):l.trigger("sync",l,t,n)):!1},n.error=t.wrapError(n.error,l,n);var h=this.isNew()?"create":"update",d=(this.sync||t.sync).call(this,h,this,n);return n.wait&&this.set(r,a),d},destroy:function(e){e=e?o.clone(e):{};var i=this,n=e.success,s=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),n?n(i,t):i.trigger("sync",i,t,e)},e.error=t.wrapError(e.error,i,e);var r=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),r},url:function(){var t=L(this,"urlRoot")||L(this.collection,"url")||S();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var n=o.extend({},t.changes,this._silent);this._silent={};for(var i in n)this.trigger("change:"+i,this,this.get(i),t);if(e)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(var i in this.changed)this._pending[i]||this._silent[i]||delete this.changed[i];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?o.has(this.changed,t):!o.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,i=!1,n=this._previousAttributes;for(var s in t)o.isEqual(n[s],e=t[s])||((i||(i={}))[s]=e);return i},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=o.extend({},this.attributes,t);var i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}});var h=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};o.extend(h.prototype,l,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var i,n,r,a,l,c,h={},d={},u=[];for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,r=t.length;r>i;i++){if(!(a=t[i]=this._prepareModel(t[i],e)))throw new Error("Can't add an invalid model to a collection");l=a.cid,c=a.id,h[l]||this._byCid[l]||null!=c&&(d[c]||this._byId[c])?u.push(i):h[l]=d[c]=a}for(i=u.length;i--;)t.splice(u[i],1);for(i=0,r=t.length;r>i;i++)(a=t[i]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=r,n=null!=e.at?e.at:this.models.length,s.apply(this.models,[n,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,r=this.models.length;r>i;i++)h[(a=this.models[i]).cid]&&(e.index=i,a.trigger("add",a,this,e));return this},remove:function(t,e){var i,n,s,r;for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,n=t.length;n>i;i++)r=this.getByCid(t[i])||this.get(t[i]),r&&(delete this._byId[r.id],delete this._byCid[r.cid],s=this.indexOf(r),this.models.splice(s,1),this.length--,e.silent||(e.index=s,r.trigger("remove",r,this,e)),this._removeReference(r));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return o.isEmpty(t)?[]:this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,n=e.success;return e.success=function(t,s,o){i[e.add?"add":"reset"](i.parse(t,o),e),n&&n(i,t)},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this;if(e=e?o.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||i.add(t,e);var n=e.success;return e.success=function(s,o){e.wait&&i.add(s,e),n?n(s,o):s.trigger("sync",t,o,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){if(e||(e={}),t instanceof c)t.collection||(t.collection=this);else{var i=t;e.collection=this,t=new this.model(i,e),t._validate(t.attributes,e)||(t=!1)}return t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!=t&&"remove"!=t||i==this)&&("destroy"==t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var d=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];o.each(d,function(t){h.prototype[t]=function(){return o[t].apply(o,[this.models].concat(o.toArray(arguments)))}});var u=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/:\w+/g,f=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(u.prototype,l,{initialize:function(){},route:function(e,i,n){return t.history||(t.history=new v),o.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[i]),t.history.route(e,o.bind(function(s){var o=this._extractParameters(e,s);n&&n.apply(this,o),this.trigger.apply(this,["route:"+i].concat(o)),t.history.trigger("route",this,i,o)},this)),this},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(p,"\\$&").replace(g,"([^/]+)").replace(f,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var v=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},m=/^[#\/]/,_=/msie [\w.]+/;v.started=!1,o.extend(v.prototype,l,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var i=window.location.search;i&&(t+=i)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(m,"")},start:function(t){if(v.started)throw new Error("Backbone.history has already been started");v.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),i=document.documentMode,n=_.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);n&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!n?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var s=window.location,a=s.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&s.hash&&(this.fragment=this.getHash().replace(m,""),window.history.replaceState({},document.title,s.protocol+"//"+s.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),v.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),i=o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return i},navigate:function(t,e){if(!v.started)return!1;e&&e!==!0||(e={trigger:e});var i=(t||"").replace(m,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];o.extend(y.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){var n=document.createElement(t);return e&&r(n).attr(e),i&&r(n).html(i),n},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof r?t:r(t),this.el=this.$el[0],e!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=L(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(o.isFunction(i)||(i=this[t[e]]),!i)throw new Error('Method "'+t[e]+'" does not exist');var n=e.match(b),s=n[1],r=n[2];i=o.bind(i,this),s+=".delegateEvents"+this.cid,""===r?this.$el.bind(s,i):this.$el.delegate(r,s,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,i=w.length;i>e;e++){var n=w[e];t[n]&&(this[n]=t[n])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=L(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}});var C=function(t,e){var i=k(this,t,e);return i.extend=this.extend,i};c.extend=h.extend=u.extend=y.extend=C;var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,n){var s=E[e];n||(n={});var a={type:s,dataType:"json"};return n.url||(a.url=L(i,"url")||S()),n.data||!i||"create"!=e&&"update"!=e||(a.contentType="application/json",a.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),t.emulateHTTP&&("PUT"===s||"DELETE"===s)&&(t.emulateJSON&&(a.data._method=s),a.type="POST",a.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",s)}),"GET"===a.type||t.emulateJSON||(a.processData=!1),r.ajax(o.extend(a,n))},t.wrapError=function(t,e,i){return function(n,s){s=n===e?s:n,t?t(e,s,i):e.trigger("error",e,s,i)}};var x=function(){},k=function(t,e,i){var n;return n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(n,t),x.prototype=t.prototype,n.prototype=new x,e&&o.extend(n.prototype,e),i&&o.extend(n,i),n.prototype.constructor=n,n.__super__=t.prototype,n},L=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},S=function(){throw new Error('A "url" property or function must be specified')};"function"==typeof define&&define.amd&&define("backbone-0.9.2",[],function(){return t})}).call(this),function(t,e){e.Backbone=e.Backbone||{},e.Backbone.API_URL="/api/v2/ajax/",e.Backbone.Model=Backbone.Model.extend({toJSON:function(){return _(_.clone(this.attributes)).extend({_nnc:e.csrf_nonce})},parse:function(t){return t&&t.results?1===t.results.length?t.results[0]:t.results:t},idField:"id",callAPIMethod:function(i,n,s){n._nnc=e.csrf_nonce;var o=this.url()+"/"+i,r=this;t.post(o,n,function(t){var e=r.parse(t);r.set(e),s&&s(e)},"json")},modelName:"",getId:function(){return this.get(this.idField)},url:function(){var t=this.getId();return void 0!==t?e.Backbone.API_URL+this.modelName+"/"+t:e.Backbone.API_URL+this.modelName}}),e.Backbone.Collection=Backbone.Collection.extend({url:function(){return e.Backbone.API_URL+this.collectionName},parse:function(t){return t.results},collectionName:""});var i=Backbone.sync;Backbone.sync=function(t,n,s){"read"!==t&&(s=s||{},s.data=s.data||{},"delete"==t?(s.headers=s.headers||{},s.headers["X-Csrf-Token"]||(s.headers["X-Csrf-Token"]=e.csrf_nonce)):s.data=_.extend(s.data,{_nnc:e.csrf_nonce}),("create"==t||"update"==t)&&(s.data=_.extend(s.data,n.toJSON())),s.data=JSON.stringify(s.data),s.contentType="application/json"),i.call(this,t,n,s)}}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("etsy.backbone",[],function(){return window.Etsy.Backbone}),function(){window.Etsy=window.Etsy||{},Etsy.LoggingParams={getFromDOM:function(t){var e={},i=$(t);if(i.length){var n=i.data();$.each(n,function(t,i){if("logging"==t.substring(0,7)){var n=t.substring(7).toLowerCase();e[n]=i}})}return e}}}(),define("common/etsy.loggingparams",[],function(){return Etsy.LoggingParams}),Etsy.onEnter=function(){var t=13,e={stopPropagation:!0,preventDefault:!0};return function(i,n){var s=$.extend({},e,n||{});return function(e){return e.which===t?(s.stopPropagation&&e.stopPropagation(),s.preventDefault&&e.preventDefault(),i.apply(this,arguments)):void 0}}}(),"function"==typeof define&&define.amd&&define("base.onEnter",[],function(){return window.Etsy.onEnter}),$.fn.vals=function(t){t=t||",";var e=($(this).val()||"").split(t);for(var i in e)e[i]=$.trim(e[i]);return e},define("base.vals",[],function(){}),function(t,e){function i(t,e,i){if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,i);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",e),n.select()}}function n(){return null!==e.getSignedInUserId()}function s(){if("undefined"!=typeof v)return v;var e=t("html").data("user-id");return e||(e=t("#header").data("user-id")),v=e?parseInt(e):null}function o(){return"undefined"==typeof m&&(m=t("html").data("user-login-name")),m}function r(){var t=navigator.cookieEnabled;return"undefined"==typeof t&&(document.cookie="testcookie",t=-1!==document.cookie.indexOf("testcookie")),t?!0:!1}function a(t){var e=f();return e.hasOwnProperty(t)?e[t]:null}function l(t,e){var i=f();i[t]=e,p(i)}function c(t){var e=f();e.hasOwnProperty(t)&&(delete e[t],p(e))}function h(t,e,i,n){n="undefined"==typeof n?null:n;var s="";if(i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),s="; expires="+o.toGMTString()}var r="; path=/";n&&(r="; domain="+n+r),document.cookie=t+"="+e+s+r}function d(){return document.body&&document.body.className?-1!==document.body.className.indexOf("is-touch"):!1}function u(t,i){e.setCookie(t,"",-1,i)}function g(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var s=i[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(e))return unescape(s.substring(e.length,s.length))}return null}function f(){var t=g(_);return null!==t?JSON.parse(t):{}}function p(t){var e=escape(JSON.stringify(t)),i=new Date;i.setTime(i.getTime()+6e5);var n="; expires="+i.toGMTString(),s="; domain=."+document.location.hostname;document.cookie=_+"="+e+n+"; path=/"+s}var v,m;e.Util={empty:function(t){var e=typeof t;return"undefined"===e||null===t||"string"===e&&0===t.length||"object"===e&&"length"in t&&0===t.length},getOrDefault:function(t,i){return e.Util.empty(t)?i:t},getCookieByName:g,setCookie:h,setSelectionRange:i,isSignedIn:n,getSignedInUserId:s,getSignedInLoginName:o,cookiesEnabled:r,readTransientValue:a,setTransientValue:l,eraseTransientValue:c,isTouch:d,deleteCookieByName:u},e.Util.selectTabFromOverlay=function(e,i){var n=t(e);n.find(".tabs li").removeClass("active"),n.find(".tabs li a").attr("aria-selected","false"),n.find(".overlay-body > div").hide(),t("#"+i).parent().addClass("active"),t("#"+i).attr("aria-selected","true"),t(e).find("[data-inline-overlay-tab-content]").attr("aria-hidden","true");var s=t("#"+i+"-content").show();return s.attr("aria-hidden","false"),s},e.Util.hasNeverSignedIn=function(){return null===g("LD")},e.Util.keyCodeInRange=function(t){var e=Array.prototype.slice.call(arguments,1),i=0,n=e.length;if(2>n||n%2!==0)return!1;for(i=0;n>i;i+=2)if(t>=e[i].charCodeAt(0)&&t<=e[i+1].charCodeAt(0))return!0;return!1},e.setSelectionRange=i,e.isSignedIn=n,e.getSignedInUserId=s,e.getSignedInLoginName=o,e.Util._resetSignedInUser=function(){v=void 0},e.cookiesEnabled=r;var _="tsd";e.readTransientValue=a,e.setTransientValue=l,e.eraseTransientValue=c,e.getCookieByName=function(t){return g(t)},e.setCookie=h,e.isTouch=d,e.deleteCookieByName=u,e.preload=function(t){for(var e,i=t.length,n=window.document,s=n.body,o=("fileSize"in n);i--;)o?(new Image).src=t[i]:(e=n.createElement("object"),e.data=t[i],e.width=e.height=0,s.appendChild(e))},t(document).on("click",".jquery-toggle",function(e){e.preventDefault(),t("#"+t(this).data("toggle-id")).toggle()}),t(document).on("keydown","a[role=button]",function(e){(32===e.keyCode||32===e.which)&&(e.preventDefault(),t(e.target).click())}),window.addEventListener?window.addEventListener("hashchange",function(){var t=document.getElementById(location.hash.substring(1));t&&(/^(?:a|select|input|button|textarea)$/i.test(t.tagName)||(t.tabIndex=-1),t.focus())},!1):window.attachEvent&&window.attachEvent("hashchange",function(){var t=document.getElementById(location.hash.substring(1));t&&(/^(?:a|select|input|button|textarea)$/i.test(t.tagName)||(t.tabIndex=-1),t.focus())}),"function"==typeof define&&define.amd&&(function(){require.config({paths:{"base.onEnter":"base.onEnter.20180122183942","base.vals":"base.vals.20180122183942"}});define("etsy.util",["base.onEnter","base.vals"],function(){return window.Etsy.Util})})()}(window.jQuery,window.Etsy),define("collections/models/Listing",[],function(){var t=Etsy.Backbone.Model.extend({modelName:"listings",idField:"listing_id",idAttribute:"listing_id",defaults:{is_fetching:!1},url:function(){return Etsy.Backbone.API_URL+this.getCollectionBasePath()+this.modelName+"/"+this.getId()},getCollectionBasePath:function(){var t=this.get("collection"),e=t.modelName+"/",i=t.get("type");return"collection"!==i&&"favorites"!==i&&(e+=i+"/"),e+=t.getId()+"/"},isNew:function(){return this.get("deleting")?!1:!0}});return t}),(function(){require.config({paths:{"collections/models/Listing":"collections/models/Listing.20180118211911"}});define("collections/models/ListingCollection",["collections/models/Listing"],function(t){var e=Etsy.Backbone.Collection.extend({model:t,collectionName:"listings",initialize:function(t){this.collectionKey=t.collectionKey,this.collectionId=t.collection_id,t&&t.fetch&&this.fetch()},url:function(){return Etsy.Backbone.API_URL+"collections/"+this.collectionKey+"/"+this.collectionName}});return e})})(),(function(){require.config({paths:{"collections/models/Listing":"collections/models/Listing.20180118211911","collections/models/ListingCollection":"collections/models/ListingCollection.20180118211911"}});define("collections/models/Collection",["jquery","collections/models/Listing","collections/models/ListingCollection"],function(t,e,i){var n=Etsy.Backbone.Model.extend({modelName:"collections",idField:"key",url:function(){var t=Etsy.Backbone.API_URL+this.modelName,e=this.get("type");if(e&&"page_collection"==e){t=Etsy.Backbone.API_URL+"pages/"+this.get("creator_id")+"/"+this.modelName;var i=this.get("id");return"undefined"!=typeof i&&(t+="/"+i),t}var i=this.getId();return"undefined"!=typeof i?t+"/"+i:t},addListing:function(i,n){var s=new e({listing_id:i,collection:this}),o={listing_id:i,collection_type:this.get("type")};n&&n.attributee_id&&(o.attributee_id=n.attributee_id),this.get("is_registry")&&Etsy.Context.data.registry_attr&&(o.registry_attr=Etsy.Context.data.registry_attr),s.save(o,{success:_.bind(function(e,o){"favorites"==this.get("type")&&t(document).trigger("etsy:favorite:add",[e.toJSON(),o]),"collection"==this.get("type")&&t(document).trigger("etsy:collect:add",[e.toJSON(),o]),this.getListings().add(s),this.trigger("listing-added",i,o),s.trigger("sync",this,o),n&&n.success&&n.success.apply(this,arguments)},this),error:_.bind(function(t,e){this.trigger("sync",this,e),n&&n.error&&n.error.apply(this,arguments)},this)})},initialize:function(){if(this.on("listing-added",this.listingAdded,this),this.on("listing-removed",this.listingRemoved,this),this.listing_index={},Etsy.Context.data.listings_to_collections||this.collection&&this.collection.listingsMap&&this.collection.listingsMap.map){var t=Etsy.Context.data.listings_to_collections;this.collection&&this.collection.listingsMap&&this.collection.listingsMap.map&&(t=this.collection.listingsMap.map),this.updateListingIndex(t)}else this.updateListingIndex();this.collection&&this.collection.listingsMap&&this.collection.listingsMap.on("sync",function(t){this.updateListingIndex(t)},this)},listingAdded:function(t){this.listing_index[t]=!0,this.trigger("sync")},listingRemoved:function(t){delete this.listing_index[t],this.trigger("sync")},updateListingIndex:function(t){this.getListings().each(function(t){t.get("listing_id")&&(this.listing_index[t.get("listing_id")]=!0)},this),t&&_(t).each(function(t,e){_(t).each(function(t){t==this.get("key")&&(this.listing_index[e]=!0)},this)},this),this.trigger("sync")},removeListing:function(t){var i,n=this.getListings().where({listing_id:t});i=0==n.length?new e({listing_id:t,collection:this,collection_type:this.get("type")}):n[0],i.set("deleting",!0),i.set("collection_type",this.get("collection_type"));var s=this;i.destroy({success:function(e,n){s.trigger("listing-removed",t),i.trigger("sync",this,n)},error:function(){console.error("Error")}})},containsListing:function(t){return t in this.listing_index},parse:function(t){var e=Etsy.Backbone.Model.prototype.parse.call(this,t);this.collectionKey=e.key,this.collectionId=e.collection_id;var i=this;if(e.listing_ids){var n=[];_.each(e.listing_ids,function(t){n.push({listing_id:parseInt(t),collection:i})}),this.getListings().reset(n)}return e},getListings:function(){return this.listings||(this.listings=new i({collectionKey:this.collectionKey,collectionId:this.collectionId})),this.listings},defaults:{is_fetching:!1},validate:function(t){var e=[];return 0==t.name.length&&e.push({message:"Your list must have a name."}),this.collection&&t.name.length>0&&this.collection.filter(function(e){return e.get("name")==t.name&&e.get("key")!=this.get("key")},this).length>0&&e.push({message:"You already have a list named "+t.name+"."}),e.length>0?e:void 0}});return n})})(),(function(){require.config({paths:{"collections/models/Collection":"collections/models/Collection.20180307224750"}});define("collections/models/CollectionCollection",["jquery","collections/models/Collection"],function(t,e){var i=Etsy.Backbone.Collection.extend({model:e,initialize:function(t){this.userId=t.userId,this.listingsMap=t.listingsMap,this.fetch()},comparator:function(e,i){if(e.get("is_favorites"))return-1;if(i.get("is_favorites"))return 1;if(!e.get("name"))return 1;if(!i.get("name"))return-1;var n=t("<div/>").html(e.get("name")).text(),s=t("<div/>").html(i.get("name")).text();return n.toLowerCase().localeCompare(s.toLowerCase())},url:function(){return Etsy.Backbone.API_URL+this.collectionName+"?user_id="+this.userId},collectionName:"collections"});return i})})(),define("template",{load:function(t){throw new Error("Dynamic load not allowed: "+t)}}),define("template!modules/collections/list_template",["lib/hogan"],function(t){function e(e){return e=e||{},e._messages=Etsy.message_catalog,i.render.call(i,e,t.partialsMap)}t.partialsMap=t.partialsMap||{};var i=new t.Template({__BUILDA_TMPL_X:"modules/collections/list_template",code:function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"ui-toolkit\">");_.b("\n" + i);_.b("    <label class=\"checkbox-custom mb-xs-1\">");_.b("\n" + i);_.b("        <input type=\"checkbox\" class=\"checkbox\" tabindex=\"0\"><span class=\"checkbox-label collection-name\">");_.b(_.v(_.f("name",c,p,0)));_.b("<span class=\"etsy-icon icon-smaller text-gray-lighter float-right\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\"><path d=\"M17,10V7A5,5,0,0,0,7,7v3H5v8a2,2,0,0,0,2,2H17a2,2,0,0,0,2-2V10H17Zm-4,7a1,1,0,0,1-2,0V13a1,1,0,0,1,2,0v4Zm2-7H9V7a2.935,2.935,0,0,1,3-3,2.935,2.935,0,0,1,3,3v3Z\"/></svg></span></span>");_.b("\n" + i);_.b("    </label>");_.b("\n" + i);_.b("</div>");return _.fl();;},X_END_BUILDA_TMPL:0,partials:t.partialsMap},"",t);return i.name="modules/collections/list_template.mustache",e.template=i,t.partialsMap[i.name]=i,e}),(function(){require.config({paths:{"template!modules/collections/list_template":"template!modules/collections/list_template.20171215193247.en-US"}});define("collections/views/CollectionList",["jquery","template!modules/collections/list_template"],function(t,e){var i=Backbone.View.extend({tagName:"li",className:"collection",render:function(){if(!this.htmlRendered){var i={name:t("<div>").html(this.model.get("name")).text()};this.$el.html(e(i)),this.htmlRendered=!0}return this.$el.removeClass("loading"),this.model.containsListing(this.options.listing_id)?(this.$el.addClass("active"),this.$el.find("input").prop("checked",!0)):(this.$el.removeClass("active"),this.$el.find("input").prop("checked",!1)),this},events:{click:"toggleCollectListing"},listingAdded:function(t,e){this.model.get("is_registry")&&Etsy.RegistryBar&&Etsy.RegistryBar.show(e.results),this.render()},listingRemoved:function(){this.model.get("is_registry")&&Etsy.RegistryBar&&Etsy.RegistryBar.hide(),this.render()},initialize:function(){this.model.on("listing-removed",this.listingRemoved,this),this.model.on("listing-added",this.listingAdded,this),this.model.on("sync",this.render,this),this.$el.addClass(this.model.get("privacy_level")+"-list"),this.model.get("is_registry")&&this.$el.addClass("registry-list")},toggleCollectListing:function(){var e;this.options.parent.trigger("loading"),this.$el.addClass("loading"),this.model.containsListing(this.options.listing_id)?(this.model.removeListing(this.options.listing_id),e=!1):(this.model.addListing(this.options.listing_id,{error:_.bind(function(e,i){var n=t.parseJSON(i.responseText);if(n&&n.errors&&n.errors[0]){var s=n.errors[0],o="";_(s).each(function(t){o+=t.join(" ")}),alert(o)}},this)}),e=!0),this.options.parent.logListingEvent(this.options.listing_id,this.model,e)}});return i})})(),(function(){require.config({paths:{"collections/views/CollectionList":"collections/views/CollectionList.20180118211911.en-US"}});define("collections/views/SharedChooser",["jquery","collections/views/CollectionList"],function(t,e){var i=13,n=27,s=9,o=Backbone.View.extend({initialize:function(){this.collection_list=this.$(".list-main"),this.aux_list=this.$(".list-aux"),this.aux_container=this.$(".aux-collections"),this.parent_view=null,this.your_lists_link=this.$(".user-collections a").prop("href","/people/"+Etsy.getSignedInLoginName()+"/favorites?ref=list_btn"),this.handleFocus()},handleFocus:function(){var t=this;this.$el.focusin(function(){t.$el.addClass("chooser-focus")}),this.$el.focusout(function(e){t.$el.removeClass("chooser-focus"),e.stopPropagation()})},alignStandard:function(){this.$el.removeClass("right-aligned")},alignRight:function(){this.$el.addClass("right-aligned")},getElRightPosition:function(t){return t.offset().left+t.width()},adjustAlignment:function(e){var i=this.getElRightPosition(this.$el),n=e&&e.length?this.getElRightPosition(e):t(window).width();i>n?this.alignRight():this.alignStandard()},events:{"click .new-collections input.text":"activateAddCollection","keyup .new-collections input.text":"addCollectionKeyUp","click .new-collections button":"handleAddCollection","keydown .new-collections button":"hideChooserKeyDown",keyup:"hideChooserKeyUp"},activateAddCollection:function(){this.$el.find(".new-collections").addClass("activated")
},addCollectionKeyUp:function(t){t.which===i&&this.handleAddCollection(t)},focusOnYourListsLink:function(){this.your_lists_link.focus()},handleAddCollection:function(e){e.preventDefault();var i=this.$("input[type=text]").val();i=t.trim(i),this.parent_view.createCollectionAndAddListing(i),this.$(".new-collections").addClass("hide"),this.collection_list.append(Etsy.template('<li class="collection loading shim"><span class="icon"></span><span class="collection-name"> <%+ name %></span>',{name:i}))},hideChooserKeyDown:function(t){t.which===s&&!t.shiftKey&&this.parent_view.container.hasClass("show-menu")&&this.parent_view.hideChooser()},hideChooserKeyUp:function(t){t.which===n&&this.parent_view.container.hasClass("show-menu")&&this.parent_view.hideChooser()},setParent:function(t){this.parent_view=t},resetState:function(){this.aux_container.hide(),this.aux_list.empty(),this.collection_list.empty();var t=this.$(".new-collections");t.removeClass("hide activated"),t.find("input.text").val(""),this.$el.removeClass("no-lists"),this.collection_list.find(".collection.shim").remove()},reinitialize:function(t,e){var i=this,n=!1,s=!1;this.resetState(),e.each(function(e){e.get("is_favorites")||(s=!0,"page_collection"===e.get("type")?(n||(i.aux_container.show(),i.aux_container.find("label").html('<a href="/pages/'+e.get("page_slug")+'?ref=list_btn">'+e.get("page_name")+"</a>"),n=!0),i.addCollection(t,e,i.aux_list)):i.addCollection(t,e,i.collection_list))}),this.$el.toggleClass("no-lists",!s)},addCollection:function(t,i,n){var s=new e({model:i,listing_id:t,parent:this.parent_view});i.on("sync",this.postListingAdded,this),n.append(s.render().el)},postListingAdded:function(){this.collection_list.find(".collection.shim").remove()}});return o})})(),define("template!modules/collections/chooser",["lib/hogan"],function(t){function e(e){return e=e||{},e._messages=Etsy.message_catalog,i.render.call(i,e,t.partialsMap)}t.partialsMap=t.partialsMap||{};var i=new t.Template({__BUILDA_TMPL_X:"modules/collections/chooser",code:function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"collection-chooser\">");_.b("\n" + i);_.b("    <div class=\"aux-collections\">");_.b("\n" + i);_.b("        <label class=\"collection-group\"></label>");_.b("\n" + i);_.b("        <ul class=\"collection-list list-aux  clear\">");_.b("\n" + i);_.b("        </ul>");_.b("\n" + i);_.b("    </div>");_.b("\n" + i);_.b("    <div class=\"user-collections\">");_.b("\n" + i);_.b("        <label class=\"collection-group\">");_.b("\n" + i);_.b("            <a>Your lists</a>");_.b("\n" + i);_.b("        </label>");_.b("\n" + i);_.b("        <ul class=\"collection-list list-main clear\">");_.b("\n" + i);_.b("        </ul>");_.b("\n" + i);_.b("\n" + i);_.b("        <div class=\"new-collections clear\">");_.b("\n" + i);_.b("            <input type=\"text\" class=\"text\" placeholder=\"New list\" />");_.b("\n" + i);_.b("            <button class=\"btn-primary small btn\">Add</button>");_.b("\n" + i);_.b("\n" + i);_.b("            <div class=\"error-msg\"></div>");_.b("\n" + i);_.b("        </div>");_.b("\n" + i);_.b("    </div>");_.b("\n" + i);_.b("\n" + i);_.b("    <span class=\"arrow\"></span>");_.b("\n" + i);_.b("</div>");return _.fl();;},X_END_BUILDA_TMPL:0,partials:t.partialsMap},"",t);return i.name="modules/collections/chooser.mustache",e.template=i,t.partialsMap[i.name]=i,e}),(function(){require.config({paths:{"collections/views/SharedChooser":"collections/views/SharedChooser.20180118211911.en-US","template!modules/collections/chooser":"template!modules/collections/chooser.20170411131503.en-US"}});define("collections/managers/SharedChooser",["jquery","collections/views/SharedChooser","template!modules/collections/chooser"],function(t,e,i){var n=function(t){this.chooser=t};return n.prototype={getChooser:function(){return this.chooser},detach:function(){this.chooser.$el.detach(),this.chooser.off()},detachFrom:function(e){var i=t(e)[0];t.contains(i,this.chooser.el)&&this.detach()},attachTo:function(t,e,i,n){this.detach(),this.chooser.setParent(e),this.chooser.reinitialize(i,n),this.chooser.$el.appendTo(t)}},n.getSingleton=function(){if(Etsy.Sets=Etsy.Sets||{},Etsy.Sets.Context=Etsy.Sets.Context||{},!Etsy.Sets.Context.collectionsChooser){var s=new e({el:t(i())});Etsy.Sets.Context.collectionsChooser=new n(s)}return Etsy.Sets.Context.collectionsChooser},n})})(),(function(){require.config({paths:{"collections/models/CollectionCollection":"collections/models/CollectionCollection.20180307224750","collections/models/Collection":"collections/models/Collection.20180307224750","collections/views/CollectionList":"collections/views/CollectionList.20180118211911.en-US","collections/managers/SharedChooser":"collections/managers/SharedChooser.20180307224750.en-US"}});define("collections/views/Button",["jquery","collections/models/CollectionCollection","collections/models/Collection","collections/views/CollectionList","collections/managers/SharedChooser"],function(t,e,i,n,s){var o=Backbone.View.extend({initialize:function(){this.user_id=Etsy.getSignedInUserId(),this.user_login_name=Etsy.getSignedInLoginName(),this.container=this.$el.parents(".collect-container"),this.shared_chooser_manager=s.getSingleton(),this.shared_chooser=this.shared_chooser_manager.getChooser(),this.recent_list=this.container.find(".list-featured"),this.count=this.$el.find(".count"),this.listing_card=this.$el.closest(".collected-listing,.listing-card,.object-card"),this.card_grid=Etsy.Context.getData("collections_use_grid",!1)?this.listing_card.parent():null,this.listing_id=this.container.data("listing-id"),this.options.listingsMap.add({listing_id:this.listing_id}),this.options.collections?this.updateCollections():this.options.collections=new e({userId:this.user_id});var t=this;this.options.collections.on("reset",this.updateCollections,this),this.options.collections.on("add",this.updateCollections,this),this.handleOutsideClick(),this.handleHover(),this.handleFocus(),this.on("loading",function(){t.container.addClass("loading"),t.$el.addClass("loading")}),this.collectionSaveSuccess=_.bind(this.collectionSaveSuccess,this),this.collectionSaveError=_.bind(this.collectionSaveError,this)},handleHover:function(){var t=this,e=null;this.listing_card.mouseleave(function(){var i=t.container.hasClass("show-menu")?500:0;e=window.setTimeout(function(){t.listing_card.removeClass("col-hover"),t.hideChooser()},i)}),this.listing_card.mouseenter(function(){t.listing_card.addClass("col-hover"),window.clearTimeout(e)})},handleFocus:function(){var t=this;this.listing_card.focusin(function(){t.listing_card.addClass("col-focus")}),this.listing_card.focusout(function(){t.shared_chooser.$el.hasClass("chooser-focus")||t.listing_card.removeClass("col-focus")})},hideChooser:function(){this.container.removeClass("show-menu"),this.shared_chooser.alignStandard(),this.shared_chooser_manager.detachFrom(this.container),this.listing_card.css({"z-index":"auto"}),this.$el.attr({"aria-expanded":!1})},events:{click:"toggleCollectionChooser"},handleOutsideClick:function(){var e=this;this.container.click(function(t){t.stopPropagation()}),t("html").click(function(){e.hideChooser()})},toggleCollectionChooser:function(e){if(this.container.toggleClass("show-menu"),this.shared_chooser.alignStandard(),this.$el.attr({"aria-expanded":this.container.hasClass("show-menu")}),this.container.hasClass("show-menu")){this.listing_card.css({"z-index":1e4});var i={php_event_name:"list_open",source:t(".btn-fave, [data-btn-fave]").data("source")};i=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),i);var n=t.extend(!0,{},i);Etsy.EventLogger.logEvent(i),n.php_event_name="collection_icon_clicked",Etsy.EventLogger.logEvent(n),this.shared_chooser_manager.attachTo(this.container,this,this.listing_id,this.options.collections),this.shared_chooser.adjustAlignment(this.card_grid),this.shared_chooser.focusOnYourListsLink()}else this.shared_chooser_manager.detachFrom(this.container);e.preventDefault()},updateCollections:function(){if(this.options.collections.each(function(t){t.off("sync",this.postListingAdded,this),t.on("sync",this.postListingAdded,this)},this),Etsy.Context.data.collection){var t=this.options.collections.where({key:Etsy.Context.data.collection.key});t.length>0&&(t[0].on("listing-removed",function(t){this.listing_id==t&&this.listing_card.addClass("removed")},this),t[0].on("listing-added",function(t){this.listing_id==t&&this.listing_card.removeClass("removed")},this))}this.updateCollectionState()},addCollection:function(t,e){var i=new n({model:t,listing_id:this.listing_id,parent:this});t.on("sync",this.postListingAdded,this),e.append(i.render().el)},postListingAdded:function(){this.updateCollectionState(),this.container.removeClass("loading"),this.$el.removeClass("loading"),this.hideChooser()},updateCollectionState:function(){var t=this.options.collections.filter(function(t){return!t.get("is_favorites")}),e=_(t).filter(function(t){return t.containsListing(this.listing_id)},this).length;e?this.$el.addClass("done"):this.$el.removeClass("done")},createCollectionAndAddListing:function(t){this.trigger("loading");var e=new i;e.save({name:t},{success:this.collectionSaveSuccess,error:this.collectionSaveError})},collectionSaveSuccess:function(e){var i=t(".favorite-container .btn-fave, .favorite-container [data-btn-fave]").data("source");this.options.collections.models.push(e),this.options.collections.trigger("add",e),e.addListing(this.listing_id);var n={php_event_name:"collection_create",collection_id:e.get("collection_id"),name:e.get("name"),source:i};n=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),n),Etsy.EventLogger.logEvent(n),this.logListingEvent(this.listing_id,e,!0)},collectionSaveError:function(e,i){if(_.isArray(i))alert(_(i).pluck("message").join(" "));else{var n=t.parseJSON(i.responseText);if(n.errors&&n.errors[0]){var s=n.errors[0],o="";_(s).each(function(t){o+=t.join(" ")}),alert(o)}else alert("There was a problem creating your collection.")}this.postListingAdded()},isInListingCard:function(){return this.container.parents(".listing-card").length>0},logListingEvent:function(e,i,n){var s=t(".favorite-container .btn-fave, .favorite-container [data-btn-fave]").data("source"),o={php_event_name:n?"list_add":"list_remove",listing_id:e,source:s};o=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),o);var r,a;i.get("is_registry")?(r=t.extend(!0,{},o),o.list_type="registry",o.list_id=i.get("collection_id"),r.php_event_name=n?"listing_registry_add":"listing_registry_remove",r.registry_id=i.get("collection_id"),Etsy.EventLogger.logEvent(r)):(a=t.extend(!0,{},o),o.list_name=i.get("name"),o.list_type="collection",o.list_id=i.get("collection_id"),a.php_event_name=n?"collection_add":"collection_remove",a.collection_name=i.get("name"),a.collection_id=i.get("collection_id"),a=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),a),Etsy.EventLogger.logEvent(a)),Etsy.EventLogger.logEvent(o)}});return o})})(),define("collections/accessibility",["jquery"],function(t){var e=function(){this.init()};return e.prototype={init:function(){var e=this;t("[data-accessible-btn-fave]").each(function(){t(this).unbind("keypress",e.clickFaveButtonOnEnter),t(this).bind("keypress",e.clickFaveButtonOnEnter)})},clickFaveButtonOnEnter:function(e){13===e.which&&t(this).find("[data-btn-fave]").click()}},e}),(function(){require.config({paths:{"collections/models/CollectionCollection":"collections/models/CollectionCollection.20180307224750","collections/accessibility":"collections/accessibility.20180118211911"}});define("collections/views/FavoriteButton",["jquery","collections/models/CollectionCollection","collections/accessibility"],function(t,e,i){var n="favorite",s=Backbone.View.extend({events:{click:"toggleFavorites"},initialize:function(){this.user_id=Etsy.getSignedInUserId(),this.container=this.$el.closest(".favorite-container"),this.listing_id=this.container.data("listing-id"),this.options.listingsMap.add({listing_id:this.listing_id}),this.options.collections?this.updateModel():this.options.collections=new e({userId:this.user_id}),this.options.collections.on("reset",this.updateModel,this),this.isCurrentCollection=!1,Etsy.Context.data.collection&&(this.isCurrentCollection=Etsy.Context.data.collection.is_favorites),new i},updateModel:function(){var t=this.options.collections.where({is_favorites:!0})[0];t&&(this.model=t,this.model.on("sync",this.render,this),this.model.on("listing-added",this.listingAdded,this),this.model.on("listing-removed",this.listingRemoved,this),this.render())},listingAdded:function(t){this.isCurrentCollection&&this.listing_id==t&&this.$el.addClass("removed")},listingRemoved:function(t){this.isCurrentCollection&&this.listing_id==t&&this.$el.removeClass("removed")},render:function(){this.$el.removeClass("loading"),this.model.containsListing(this.listing_id)?this.$el.addClass("done").attr({"aria-pressed":!0}):this.$el.removeClass("done").attr({"aria-pressed":!1})},toggleFavorites:function(e){if(e.preventDefault(),e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0,this.model){var i=this.$el.data("source"),s=this.$el.data("can-refavorite")||!1,o=this.$el.data("attributee-id"),r=!0;this.$el.addClass("loading"),this.model.containsListing(this.listing_id)?this.model.removeListing(this.listing_id):(o?this.model.addListing(this.listing_id,{attributee_id:o}):this.model.addListing(this.listing_id),r=!1);var a={php_event_name:r?"remove_favorite_item":"favorite_item",listing_id:this.listing_id,source:i};a=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),a),"listing"==i&&(a.shop_id=this.$el.data("shop-id"),a.shop_user_id=this.$el.data("shop-user-id"),a.shop_shop_id=this.$el.data("shop-shop-id"),a.position=this.$el.data("position")),!r&&o&&(a.attributee_id=o,a.attribution_source=this.$el.data("attribution-source")||n,t(document).trigger("etsy:favorite:button:toggle",[this.listing_id,i,o,s]));var l=t.extend(!0,{},a),c=t.extend(!0,{},a);Etsy.EventLogger.logEvent(a),l.php_event_name=l.php_event_name+"_clicked",Etsy.EventLogger.logEvent(l),c.php_event_name="favorite_item"===a.php_event_name?"list_add":"list_remove",c.list_type="favorites",Etsy.EventLogger.logEvent(c)}}});return s})})(),define("collections/models/CollectionListingsMap",["jquery"],function(t){var e=Backbone.Collection.extend({map:{},fetchCollections:function(){var e=this.pluck("listing_id");e.length&&t.ajax({url:Etsy.Backbone.API_URL+"collections/listings_map",data:{listing_ids:e.join(",")},context:this}).done(function(t){t.results&&t.results[0]&&(this.reset(),_.each(t.results[0],function(t,e){this.map[e]||(this.map[e]=[]),_.each(t,function(t){this.map[e].push(t)},this)},this),this.trigger("sync",t.results[0]))})}});return e}),(function(){require.config({paths:{"etsy.util":"etsy.util.20180620212309","collections/views/Button":"collections/views/Button.20180307224750.en-US","collections/views/FavoriteButton":"collections/views/FavoriteButton.20180309164512","collections/models/CollectionListingsMap":"collections/models/CollectionListingsMap.20180118211911","collections/models/CollectionCollection":"collections/models/CollectionCollection.20180307224750"}});define("collections/App",["jquery","etsy.util","collections/views/Button","collections/views/FavoriteButton","collections/models/CollectionListingsMap","collections/models/CollectionCollection"],function(t,e,i,n,s,o){var r=function(){Etsy.getSignedInUserId()&&(this.listingsMap=new s,this.userCollections=new o({userId:Etsy.getSignedInUserId(),listingsMap:this.listingsMap}),this.initializeButtons())};return r.prototype={initializeButtons:function(){var e=this;t(".btn-collect, [data-btn-collect]").not(".overlay-trigger").each(function(){if(!t(this).data("view")){var n=new i({el:t(this),listingsMap:e.listingsMap,collections:e.userCollections});t(this).data("view",n)}}),t(".btn-fave, [data-btn-fave]").not(".overlay-trigger").each(function(){if(!t(this).data("view")){var i=new n({el:t(this),listingsMap:e.listingsMap,collections:e.userCollections});t(this).data("view",i)}}),this.listingsMap.fetchCollections()}},r.init=function(){return Etsy.Sets=Etsy.Sets||{},Etsy.Sets.Context=Etsy.Sets.Context||{},Etsy.Sets.Context.app||(Etsy.Sets.Context.app=new r),Etsy.Sets.Context.app},r})})(),require({paths:{"backbone-0.9.2":"backbone-0.9.2.20170925210114","etsy.backbone":"etsy.backbone.20170615210935","common/etsy.loggingparams":"common/etsy.loggingparams.20180118211911","collections/App":"collections/App.20180620212309.en-US"}},["jquery","backbone-0.9.2","etsy.backbone","common/etsy.loggingparams","collections/App"],function(t,e,i,n,s){var o=s.init();void 0===t&&Etsy.Logger.error("Unexpected missing jquery implementation"),t(document.body).on("etsy.listing.loaded",null,{},function(){o.initializeButtons()})}),"function"==typeof define&&define.amd&&define("bootstrap/collections/button",[],function(){});